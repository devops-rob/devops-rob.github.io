<!doctype html><html><head><title>Architecting Vault - Part 4</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><meta property="og:title" content="Architecting Vault - Part 4"><meta property="og:description" content="Part 4 in a blog series exploring architectural the design decisions of a Vault architect"><meta property="og:type" content="article"><meta property="og:url" content="https://devops-rob.github.io/posts/vault/architecting-vault-part-4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-06T08:06:25+06:00"><meta property="article:modified_time" content="2019-08-06T08:06:25+06:00"><meta name=description content="Part 4 in a blog series exploring architectural the design decisions of a Vault architect"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>DevOps Rob</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/conference-talks/>Conference Talks</a><ul><li><a href=/posts/conference-talks/devops-exchange-london-march-2022/ title="DevOps Exchange London March 2022">DevOps Exchange London March 2022</a></li><li><a href=/posts/conference-talks/hashiconf-eu-2021/ title="HashiConf EU 2021: The Zero Trust Mindset">HashiConf EU 2021: The Zero Trust Mindset</a></li><li><a href=/posts/conference-talks/hashitalks-2020/ title="HashiTalks 2020: Securing RabbitMQ with Vault">HashiTalks 2020: Securing RabbitMQ with Vault</a></li><li><a href=/posts/conference-talks/kafka-summit-eu-2021/ title="Kafka Summit EU 2021: Encrypting Kafka messages at rest to secure applications">Kafka Summit EU 2021: Encrypting Kafka messages at rest to secure applications</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/devops/>DevOps</a><ul><li><a href=/posts/devops/what-is-the-future-of-devops/ title="What is the future of DevOps">What is the future of DevOps</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/vault/>HashiCorp Vault</a><ul class=active><li><a href=/posts/vault/architecting-vault-part-1/ title="Architecting Vault - Part 1">Architecting Vault - Part 1</a></li><li><a href=/posts/vault/architecting-vault-part-2/ title="Architecting Vault - Part 2">Architecting Vault - Part 2</a></li><li><a href=/posts/vault/architecting-vault-part-3/ title="Architecting Vault - Part 3">Architecting Vault - Part 3</a></li><li><a class=active href=/posts/vault/architecting-vault-part-4/ title="Architecting Vault - Part 4">Architecting Vault - Part 4</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/the-devops-lab-videos/>The DevOps Lab (Channel9)</a><ul><li><a href=/posts/the-devops-lab-videos/part1-automating-secrets-management/ title="Automating Secrets Management - Part 1">Automating Secrets Management - Part 1</a></li><li><a href=/posts/the-devops-lab-videos/part2-automating-secrets-management/ title="Automating Secrets Management - Part 2">Automating Secrets Management - Part 2</a></li><li><a href=/posts/the-devops-lab-videos/workload-authentication/ title="Workload authentication">Workload authentication</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://devops-rob.github.io/images/vault/part4-hero.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/authors/hashiconf_huebbfad1edfa8e198fe68a27ac6a615ca_208200_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Rob Barnes</h5><p>Tuesday, August 6, 2019</p></div><div class=title><h1>Architecting Vault - Part 4</h1></div><div class=post-content id=post-content><p>In this blog edition, we’ll look at what Vault’s seal status means, different ways to unseal vault servers and when we can expect to find vault in a sealed state.</p><p>Sealing is Vault protective mechanism that prevents you secrets from being accessible if the Vault server is ever compromised in any way. When you first deploy a Vault server, it is in a sealed state, which means, there aren’t many actions you can perform on the server. In fact, the only actions you can perform on Vault whilst in a sealed state are:</p><ol><li>Check the Vault status</li><li>Initialise and unseal the Vault.</li></ol><p>When a Vault server is first deployed, the first thing you will have to do to it is initialise it. The initialisation process generates a couple of things which are crucial to the management of the server.</p><p>Firstly, it will generate five unseal keys. As the name suggests, these keys can be used to unseal the Vault server. By default, you need any three of the five unseal keys to unseal the server.</p><p>The second thing that the initialisation process does for us is generate a root token for us to use to log in to the server and perform initial configuration tasks. The root token is similar to the root user on Linux systems in that, it has unrestricted access to everything. This token should be handled with care and should eventually be deleted once the server has been properly configured. There are mechanisms built into to Vault that allow operators to re-generate new root tokens if they have the correct permissions.</p><p>Going back to unsealing the Vault server, the unseal keys generated by the init process are equally as sensitive as the root token and too, need to be handled with care. The keys should never be stored together as that defeats the object. Instead, they should be carefully distributed out to five trusted operators to store securely.</p><p>In the event of a server restart, the Vault server will need to be unsealed, which requires three out of the 5 operators to enter their unseal keys in order to restore Vault services to normal. This is fine when the restart happens during the working day; however, it’s not so cool if the server restart occurs at 3am on a Sunday morning. This scenario would mean having to wake up engineers in the middle of the night for them to enter their unseal keys.</p><p>When Architecting your Vault deployment, there is a feature you can include in your design that solves this problem. This feature is Vault auto-unseal. This feature uses a trusted cloud Key Management System (KMS) to automatically unseal the server when this feature is configured. This is done by the KMS decrypting and encrypting the Vault server’s master key.</p><p>Vault supports auto-unsealing using KMS offerings from the four main cloud providers (Azure, AWS, GCP and Alicloud). In addition to these options, there is also an Enterprise only option of PKCS11 with HSM auto-unseal mechanism as well as the in-built Transit mechanism that you can take advantage of.</p><h3 id=which-auto-unseal-mechanism-should-i-choose>Which auto-unseal mechanism should I choose?</h3><p>Much like many of the other architectural decisions that we have discussed over this series of blogs, the answer to this question will differ from one organisation to the next and will depend on one main factor, which is, what cloud strategy if any is in place?</p><p>Organisations with a cloud strategy will more than likely choose an auto-unseal mechanism with their main cloud provider; however, organisations who pay for a Vault Enterprise license may prefer to take advantage of the PKCS11 options, which after all is one of the features they are paying for. Organisations who are completely on-premise and using open source Vault are better suited to the Vault Transit mechanism. Whichever option you choose when enabling auto-unsealing, it should reflect the technology roadmap of the organisation.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/devops-rob/devops-rob.github.io/edit/main/content/posts/vault/architecting-vault-part-4.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/vault/architecting-vault-part-3/ title="Architecting Vault - Part 3" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Architecting Vault - Part 3</div></a></div><div class="col-md-6 next-article"><a href=/posts/the-devops-lab-videos/part1-automating-secrets-management/ title="Part 1 | Zero Trust Security (ZTS) with HashiCorp and Azure: Automating Secrets Management" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Part 1 | Zero Trust Security (ZTS) with HashiCorp and Azure: Automating Secrets Management</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#which-auto-unseal-mechanism-should-i-choose>Which auto-unseal mechanism should I choose?</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://devops-rob.github.io#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://devops-rob.github.io#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://devops-rob.github.io#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:iam@devopsrob.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>iam@devopsrob.com</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4></a></div><div class="col-md-4 text-center">© 2022 Copyright.</div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>